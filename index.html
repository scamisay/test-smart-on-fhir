<!DOCTYPE html>
<html>

<head>
  <script data-require="jquery@*" data-semver="2.0.3" src="https://code.jquery.com/jquery-2.0.3.min.js"></script>
  <script src="https://cdn.rawgit.com/smart-on-fhir/client-js/v0.1.8/dist/fhir-client.js"></script>
  <script type="module" src="https://unpkg.com/x-frame-bypass"></script>
  <!-- <script src="demo-settings.js"></script> -->
</head>

<body>

  <h2>index</h2>

  <iframe is="x-frame-bypass" id="iframe" src="launch-patient.html?iss=https://fhir-myrecord.sandboxcerner.com/dstu2/0b8a0111-e8e6-4c26-a91c-5069cbc6b1ca"
  width="550px" height="850px">
  </iframe>


  <!-- <script src="get-data.js"></script> -->
  <script>
  // $('#iframe').on('load', function() {
  //   alert('frame has (re)loaded ');
  // });
    // $('#iframe').contents().find('h2').text()
    window.addEventListener("message", function (e) {
      alert(e);
    	var oauthMessage = e.data;
    	loginWindow.close();
    	processOAuthMessage(oauthMessage);
    }, false);
  </script>

  <script>

  function build_oauth_request_url(){
    return "launch-patient.html?iss=https://fhir-myrecord.sandboxcerner.com/dstu2/0b8a0111-e8e6-4c26-a91c-5069cbc6b1ca";
  }

  var width = 780,
      height = 550,
      left = (screen.width - width) / 2,
      top = (screen.height - height) / 2,
      uniqueWindowId = "authorization-" + yourAppClientId
      params,
      location;
  if (top > 20) {
  	top = top - 20;
  }
  params = 'width=' + width + ', height=' + height;
  params += ', top=' + top + ', left=' + left;
  params += 'titlebar=no, location=yes';
  location = build_oauth_request_url();
  loginWindow = window.open(location, uniqueWindowId, params);

  </script>
</body>

</html>
